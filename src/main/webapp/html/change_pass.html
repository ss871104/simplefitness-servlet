<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/boostrap/bootstrap.min.css">
    <link rel="stylesheet" href="../css/change_pass.css">

    <title>更改密碼</title>

 
</head>

<body>

    <div class="topnav">

        <a class="img_link" href="http://localhost:5500/html/home.html">
            <img class="logoImg" src="../img/Simple_Fitness-logos_white.png" alt="">
        </a>

        <ul class="list-inline">
            <li class="dropdown">
                <a class="topnavBtn" id="home" href="http://localhost:5500/html/home.html">
                    <img class="icon" src="../img/home.png" alt="" title="首頁">
                </a>
                <div class="dropdown-content">
                    <ul>
                        <li><a href="#">最新消息</a></li>
                        <li><a href="#">場館資訊</a></li>
                        <li><a href="#">課程資訊</a></li>
                        <li><a href="#">收費方式</a></li>
                    </ul>
                </div>
            </li>
            <li>
                <a class="topnavBtn" id="cart" href="#cart">
                    <img class="icon" src="../img/cart.png" alt="" title="購物車">
                </a>
            </li>
            <li>
                <a class="topnavBtn" id="notice" href="#notice">
                    <img class="icon" src="../img/bell.png" alt="" title="通知中心">
                </a>
            </li>
            <li class="dropdown">
                <a class="topnavBtn" id="user" href="#user">
                    <img class="icon" src="../img/user.png" alt="" title="會員">
                </a>
                <div class="dropdown-content">
                    <ul>
                        <li><a href="#">登出</a></li>
                    </ul>
                </div>
            </li>
        </ul>
    </div>
    <div class="contentArea">
        <div class="side-menu">

            <ul class="nav">
                <li>
                    <a href="#">
                        <i class="fa fa-users" aria-hidden="true"></i>
                        會員資料編輯
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fa fa-gavel" aria-hidden="true"></i>
                        課程預約
                    </a>
                    <ul>
                        <li>
                            <a href="http://localhost:5500/html/course_booking.html">
                                預約團課
                            </a>
                        </li>
                        <li>
                            <a href="http://localhost:5500/html/coach_booking.html">
                                預約教練課
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                我的預約
                            </a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#">
                        <i class="fa fa-coins" aria-hidden="true"></i>
                        租借用品
                    </a>
                    <ul>
                        <li>
                            <a href="#">
                                我的租借清單
                            </a>
                        </li>
                    </ul>
                </li>
                <!-- <li>
                    <a href="#">
                        <i class="fa fa-pencil" aria-hidden="true"></i>
                        我的文章
                    </a>
                </li> -->
            </ul>
        </div>

        <div class="change-pass">
            <div class="content-body">
                <div class="pass-input">
                    <h4>更改密碼</h4>
                    舊密碼
                    <input type="password" class="form-control" placeholder="舊密碼" id="oPassword"><br>
                    新密碼
                    <input type="password" class="form-control" placeholder="新密碼" id="nPassword"><br>
                    確認新密碼
                    <input type="password" class="form-control" placeholder="確認新密碼" id="confirm-nPassword"><br>
                    <button type="button" class="btn-submit" id="change">確認</button>
                    <div id="errMsg" class="error" style="color: red;"></div>
                </div>
                    
            </div>
        </div>

    </div>

    <script>
    	const old_password = document.querySelector('#oPassword');
        const password = document.querySelector('#nPassword');
        const confirm_pass = document.querySelector('#confirm-nPassword');

        document.getElementById('nPassword').addEventListener('input', () => {
            const pwdLength = password.value.length;
            if (pwdLength < 8 || pwdLength > 50) {
                errMsg.textContent = '密碼長度須介於8~50字元';
                return;
            } else {
                errMsg.textContent = '';
            }
        });
        document.getElementById('confirm-nPassword').addEventListener('input', () => {
            if (confirm_pass.value !== password.value) {
                errMsg.textContent = '密碼與確認密碼不相符';
                return;
            } else {
                errMsg.textContent = '';
            }
        });
        
        document.getElementById('change').addEventListener('click', () => {
            const pwdLength = password.value.length;
            if (pwdLength < 8 || pwdLength > 50) {
                errMsg.textContent = '密碼長度須介於8~50字元';
                return;
            }
            if (confirm_pass.value !== password.value) {
                errMsg.textContent = '密碼與確認密碼不相符';
                return;
            }
            fetch('http://localhost:8080/simplefitness-servlet/member/changePass', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                memPassword: old_password.value,
                memNewPassword: password.value
            }),
            })
            .then(resp => resp.json())
            .then(body => {
                errMsg.textContent = '';
                const { successful, message } = body;
                if (successful) {
                    location = './member_edit.html';
                } else {
                errMsg.textContent = message;
                }
            });
        });

    </script>

</body>

</html>
