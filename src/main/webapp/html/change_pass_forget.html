<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/boostrap/bootstrap.min.css">
    <link rel="stylesheet" href="../css/change_pass_forget.css">

    <title>更改密碼</title>

</head>

<body>

    <div class="topnav">

        <img class="logoImg" href="#home" src="../img/Simple_Fitness-logos_white.png" alt="">
        <ul class="list-inline">
            <li>
                <a class="topnavBtn" id="home" href="#home">最新消息</a>
            </li>
            <li>
                <a class="topnavBtn" id="news" href="#news">場館資訊</a>
            </li>
            <li>
                <a class="topnavBtn" id="content" href="#contact">教練資訊</a>
            </li>
            <li>
                <a class="topnavBtn" id="about" href="#about">課程資訊</a>
            </li>
            <li>
                <a class="topnavBtn" id="about" href="#about">收費方式</a>
            </li>
            <!-- <li>
                <a class="topnavBtn" id="about" href="#about">討論區</a>
            </li> -->
            <li class="dropdown">
                <a class="topnavBtn" id="user" href="#user">
                    <img class="icon" src="../img/user.png" alt="" title="會員">
                </a>
                <div class="dropdown-content">
                    <ul>
                        <li><a href="#">會員中心</a></li>
                        <li><a href="#">登入</a></li>
                        <li><a href="#">登出</a></li>
                    </ul>
                </div>
            </li>
        </ul>
    </div>

    <div class="contentArea">
        <div class="login-block">
            <div class="login-input">
                <h4>更改密碼</h4>
                新密碼
                <input type="password" class="form-control" placeholder="新密碼" id="nPassword"><br>
                新密碼確認
                <input type="password" class="form-control" placeholder="新密碼確認" id="confirm-nPassword"><br>
                <button type="button" class="btn-submit" id="change">確認</button>
                <div id="errMsg" class="error" style="color: red;"></div>
            </div>
        </div>   
    </div>

    <script>
        const password = document.querySelector('#nPassword');
        const confirm_password = document.querySelector('#confirm-nPassword');
        const errMsg = document.querySelector('#errMsg');

        password.addEventListener('input', () => {
            const pwdLength = password.value.length;
            if (pwdLength < 8 || pwdLength > 50) {
                errMsg.textContent = '密碼長度須介於8~50字元';
                return;
            } else {
                errMsg.textContent = '';
            }
        });
        confirm_password.addEventListener('input', () => {
            if (confirm_password.value !== password.value) {
                errMsg.textContent = '密碼與確認密碼不相符';
                return;
            } else {
                errMsg.textContent = '';
            }
        });
        document.getElementById('change').addEventListener('click', () => {
            const pwdLength = password.value.length;
            if (pwdLength < 8 || pwdLength > 50) {
                errMsg.textContent = '密碼長度須介於8~50字元';
                return;
            }
            if (confirm_password.value !== password.value) {
                errMsg.textContent = '密碼與確認密碼不相符';
                return;
            }
            fetch('http://localhost:8080/simplefitness-servlet/member/changeforgetpass', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                memNewPassword: password.value
            }),
            })
            .then(resp => resp.json())
            .then(body => {
                errMsg.textContent = '';
                const { successful, message } = body;
                if (successful) {
                	window.alert("密碼修改成功！跳轉至登入畫面");
                    location = './login.html';
                } else {
                errMsg.textContent = message;
                }
            });
        });

    </script>

</body>

</html>