<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>租借首頁</title>
    <link rel="stylesheet" href="../../css/member/rent.css" />
    <link rel="stylesheet" href="../../css/member/rentOne.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
      integrity="sha384-xeJqLiuOvjUBq3iGOjvSQSIlwrpqjSHXpduPd6rQpuiM3f5/ijby8pCsnbu5S81n"
      crossorigin="anonymous"
    />
    <script src="../../js/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <div style="height: auto">
      <div class="topnav">
        <img
          class="logoImg"
          href="#home"
          src="../../img/Simple_Fitness-logos_white.png"
          alt=""
        />

        <ul class="list-inline">
          <li class="dropdown">
            <a class="topnavBtn" id="home" href="#home">
              <img class="icon" src="../../img/home.png" alt="" title="首頁" />
            </a>
            <div class="dropdown-content">
              <ul>
                <li><a href="#">最新消息</a></li>
                <li><a href="#">場館資訊</a></li>
                <li><a href="#">課程資訊</a></li>
                <li><a href="#">收費方式</a></li>
              </ul>
            </div>
          </li>
          <li>
            <a class="topnavBtn" id="cart" href="./cart.html">
              <img
                class="icon"
                src="../../img/cart.png"
                alt=""
                title="購物車"
              /><span>0</span>
            </a>
          </li>
          <li>
            <a class="topnavBtn" id="notice" href="#notice">
              <img
                class="icon"
                src="../../img/bell.png"
                alt=""
                title="通知中心"
              />
            </a>
          </li>
          <li class="dropdown">
            <a class="topnavBtn" id="user" href="#user">
              <img class="icon" src="../../img/user.png" alt="" title="會員" />
            </a>
            <div class="dropdown-content">
              <ul>
                <li><a href="#">登出</a></li>
              </ul>
            </div>
          </li>
        </ul>
      </div>

      <!-- contentArea -->
      <div class="contentArea">
        <!-- aside -->
        <div class="side-menu">
          <ul class="nav">
            <li>
              <a href="#">
                <i class="fa fa-users" aria-hidden="true"></i>
                會員資料編輯
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa fa-gavel" aria-hidden="true"></i>
                課程預約
              </a>
              <ul>
                <li>
                  <a href="#"> 我的預約 </a>
                </li>
                <li>
                  <a href="#"> 預約團課/教練課 </a>
                </li>
              </ul>
            </li>
            <li>
              <a href="./rentFront.html" style="background-color: #7bb593">
                <i class="fa fa-coins" aria-hidden="true"></i>
                租借用品
              </a>
              <ul>
                <li>
                  <a href="#"> 我的租借清單 </a>
                </li>
              </ul>
            </li>
          </ul>
        </div>

        <!-- main -->
        <main class="main">
          <div class="container">

            <div class="img_block">
           
            </div>
            <div class="right">
              <ul>
                <h1 class="prdName"></h1>
              </ul>
              <ul class="prdInfo"></ul>
              <ul>
                租借價
                $ <span class="prdPrice"></span>
              </ul>
              <ul>
                <li>結帳方式： 線上信用卡/ 憑證臨櫃支付</li>

                <li>
                  租借數量：
                  <select name="count" id="count"></select>
                </li>
              </ul>
              <div class="btnArea">
                <button type="button" class="cart-plus">
                  <i class="bi bi-cart-plus"></i> 加入購物車
                </button>
                <button type="button" class="cart-check">直接結帳</button>
              </div>
            </div>
      
          </div>
        </main>
      </div>
    </div>

    <script src="../../js/member/rentFront.js"></script>
    <script src="../../js/member/cart.js"></script>
    <script>
    cartproduct = sessionStorage.getItem("cartproduct");
	cartproduct = JSON.parse(cartproduct);
	$(".img_block").html(`<img id="prdImg" src="${cartproduct.img}"/>`);
	$(".prdName").text(cartproduct.name);
	$(".prdInfo").html(`<li>${cartproduct.intro}</li>`);
	$(".prdPrice").text(cartproduct.price);
    for (i = 1; i <= cartproduct.count; i++) {
    	let html = `<option value="${i}">${i}</option>`;
    	$("#count").append(html);
    };
    $(".cart-plus").on("click", function(e) {
		e.preventDefault();
		cartNumbers(cartproduct);
	})
	$(".cart-check").on("click", function(e) {
		cartNumbers(cartproduct);
		location ="./cart.html";
	})
	
	function cartNumbers(product) {
	let productNumbers = sessionStorage.getItem("cartNumbers");
	let cartItems = sessionStorage.getItem("productsInCart");
	cartItems = JSON.parse(cartItems);
	productNumbers = parseInt(productNumbers);
	prdCount = parseInt($("#count").val());
	if (productNumbers) {
		if (cartItems[product.name] == undefined) {
			sessionStorage.setItem("cartNumbers", productNumbers + prdCount);
			document.querySelector("#cart span").textContent = productNumbers + prdCount;
		}else{
			if(cartItems[product.name].inCart < cartItems[product.name].count){
			sessionStorage.setItem("cartNumbers", productNumbers + prdCount);
			document.querySelector("#cart span").textContent = productNumbers + prdCount;
			}
		}
// 		sessionStorage.setItem("cartNumbers", productNumbers + prdCount);
// 		document.querySelector("#cart span").textContent = productNumbers + prdCount;
	} else {
		sessionStorage.setItem("cartNumbers", prdCount);
		document.querySelector("#cart span").textContent = prdCount;
	}
	setItem(product);
	}
    
    function setItem(product) {
    	let cartItems = sessionStorage.getItem("productsInCart");
    	cartItems = JSON.parse(cartItems);

    	if (cartItems != null) {

    		if (cartItems[product.name] == undefined) {
    			cartItems = {
    				...cartItems,  
    				[product.name]: product
    			}
    		}
    		if(cartItems[product.name].inCart < cartItems[product.name].count){
    			cartItems[product.name].inCart += prdCount;
    		}
    		

    	} else {
    		product.inCart = prdCount;
    		cartItems = {
    			[product.name]: product
    		}
    	}

    	sessionStorage.setItem("productsInCart", JSON.stringify(cartItems));
    }

    </script>
  </body>
</html>
